<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Early Stopping • compboost</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Early Stopping">
<meta property="og:description" content="">
<meta property="og:image" content="https://schalkdaniel.github.io/compboost/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">compboost</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Getting Started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting_started/about_cboosting.html">About Component-Wise Boosting</a>
    </li>
    <li>
      <a href="../../articles/getting_started/use_case.html">First Use-Case</a>
    </li>
    <li>
      <a href="../../articles/getting_started/early_stopping.html">Early Stopping</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/advanced/ext_losses.html">Extending Losses</a>
    </li>
    <li>
      <a href="../../articles/advanced/ext_blearner.html">Extending Base-Learner</a>
    </li>
    <li>
      <a href="../../articles/advanced/log_performance.html">Logging Performance Measures</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Functionality
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/functionality/baselearner.html">Base-Learner</a>
    </li>
    <li>
      <a href="../../articles/functionality/loss.html">Loss Functions</a>
    </li>
    <li>
      <a href="../../articles/functionality/logger.html">Logger</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/schalkdaniel/compboost">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Early Stopping</h1>
            
      
      
      <div class="hidden name"><code>early_stopping.Rmd</code></div>

    </div>

    
    
<div id="before-starting" class="section level2">
<h2 class="hasAnchor">
<a href="#before-starting" class="anchor"></a>Before Starting</h2>
<ul>
<li>Read the <a href="https://danielschalk.com/compboost/articles/getting_started/use_case.html">use-case</a> to get to know how to define a <code>Compboost</code> object using the <code>R6</code> interface</li>
</ul>
</div>
<div id="data-titanic-passenger-survival-data-set" class="section level2">
<h2 class="hasAnchor">
<a href="#data-titanic-passenger-survival-data-set" class="anchor"></a>Data: Titanic Passenger Survival Data Set</h2>
<p>We use the <a href="https://www.kaggle.com/c/titanic/data">titanic dataset</a> with binary classification on <code>Survived</code>. First of all we store the train and test data into two data frames and remove all rows that contains missing values (<code>NA</code>s):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Store train and test data:</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">df =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(titanic<span class="op">::</span>titanic_train)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">df<span class="op">$</span>Survived =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(df<span class="op">$</span>Survived, <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"no"</span>, <span class="st">"yes"</span>))</a></code></pre></div>
<p>For the later stopping we split the dataset into train and test:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">idx_train =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(df)), <span class="dt">size =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(df) <span class="op">*</span><span class="st"> </span><span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">idx_test =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sets">setdiff</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(df)), idx_train)</a></code></pre></div>
</div>
<div id="defining-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-the-model" class="anchor"></a>Defining the Model</h2>
<p>We define the same model as in the <a href="https://danielschalk.com/compboost/articles/getting_started/use_case.html">use-case</a> but just on the train index without specifying an out of bag fraction:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">cboost =<span class="st"> </span>Compboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">data =</span> df[idx_train, ], <span class="dt">target =</span> <span class="st">"Survived"</span>, <span class="dt">loss =</span> LossBinomial<span class="op">$</span><span class="kw">new</span>())</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">cboost<span class="op">$</span><span class="kw">addBaselearner</span>(<span class="st">"Age"</span>, <span class="st">"spline"</span>, BaselearnerPSpline)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">cboost<span class="op">$</span><span class="kw">addBaselearner</span>(<span class="st">"Fare"</span>, <span class="st">"spline"</span>, BaselearnerPSpline)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">cboost<span class="op">$</span><span class="kw">addBaselearner</span>(<span class="st">"Sex"</span>, <span class="st">"categorical"</span>, BaselearnerPolynomial, <span class="dt">intercept =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="early-stopping-in-compboost" class="section level2">
<h2 class="hasAnchor">
<a href="#early-stopping-in-compboost" class="anchor"></a>Early Stopping in Compboost</h2>
<div id="how-does-it-work" class="section level3">
<h3 class="hasAnchor">
<a href="#how-does-it-work" class="anchor"></a>How does it work?</h3>
<p>The early stopping of <code>compboost</code> is done by using the logger objects. The logger is executed after each iteration and stores class dependent data, e.g. the runtime. Additionally, each logger can be declared as a stopper with <code>use_as_stopper = TRUE</code>. Declaring a logger as stopper, the logged data is used to stop the algorithm after a logger-specific criteria is reached. For example, using <code>LoggerTime</code> as stopper will break the algorithm algorithm after a pre-defined runtime is reached.</p>
</div>
<div id="example-with-runtime-stopping" class="section level3">
<h3 class="hasAnchor">
<a href="#example-with-runtime-stopping" class="anchor"></a>Example with runtime stopping</h3>
<p>Now it is time to define a logger to track the runtime. As mentioned above, we set <code>use_as_stopper = TRUE</code>. Now it matters what is specified in <code>max_time</code> since this defines how long we like to train the model. Here we want to stop after 50000 microseconds:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">cboost<span class="op">$</span><span class="kw">addLogger</span>(<span class="dt">logger =</span> LoggerTime, <span class="dt">use_as_stopper =</span> <span class="ot">TRUE</span>, <span class="dt">logger_id =</span> <span class="st">"time"</span>,</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="dt">max_time =</span> <span class="dv">50000</span>, <span class="dt">time_unit =</span> <span class="st">"microseconds"</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">cboost<span class="op">$</span><span class="kw">train</span>(<span class="dv">2000</span>, <span class="dt">trace =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;    1/2000   risk = 0.73  time = 1   </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;  100/2000   risk = 0.66  time = 13487   </span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;  200/2000   risk = 0.63  time = 27097   </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  300/2000   risk = 0.62  time = 40551   </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; Train 367 iterations in 0 Seconds.</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; Final risk based on the train set: 0.62</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">cboost</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; Component-Wise Gradient Boosting</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; Trained on df[idx_train, ] with target Survived</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; Number of base-learners: 4</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; Learning rate: 0.05</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; Iterations: 367</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; Offset: 0.1933</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; LossBinomial Loss:</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt;   Loss function: L(y,x) = log(1 + exp(-2yf(x))</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt; </span></a></code></pre></div>
<p>As we can see, the fittings is stopped after 367 and not after 2000 iterations as specified in train. Taking a look at the logger data, we can see that the last entry exceeds the 50000 microseconds and therefore triggers the stopping criteria:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(cboost<span class="op">$</span><span class="kw">getLoggerData</span>())</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt;     _iterations  time</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; 362         362 49411</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; 363         363 49542</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 364         364 49677</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 365         365 49808</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; 366         366 49939</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; 367         367 50063</span></a></code></pre></div>
</div>
</div>
<div id="loss-based-early-stopping" class="section level2">
<h2 class="hasAnchor">
<a href="#loss-based-early-stopping" class="anchor"></a>Loss-Based Early Stopping</h2>
<p>In machine learning we often like to stop when the best model performance is reached. Especially in boosting, which may tend to overfit, we need either tuning or early stopping to determine what is a good number of iterations <span class="math inline">\(m\)</span> to get a good model performance. A well-known procedure is to log the out of bag (oob) behavior of the model and stop after this starts to get worse. This is how the oob early stopping is implemented in <code>compboost</code>. The parameter we need to specify are</p>
<ul>
<li><p>the loss <span class="math inline">\(L\)</span> that is used for stopping: <span class="math display">\[\mathcal{R}_{\text{emp}}^{[m]} = \frac{1}{n}\sum_{i=1}^n L\left(y^{(i)}, f^{[m]}(x^{(i)})\right)\]</span></p></li>
<li><p>the percentage of performance increase that should be undershot: <span class="math display">\[\text{err}^{[m]} = \frac{\mathcal{R}_{\text{emp}}^{[m- 1]} - \mathcal{R}_{\text{emp}}^{[m]}}{\mathcal{R}_{\text{emp}}^{[m - 1]}}\]</span></p></li>
</ul>
<div id="define-the-risk-logger" class="section level3">
<h3 class="hasAnchor">
<a href="#define-the-risk-logger" class="anchor"></a>Define the risk logger</h3>
<p>Since we are interested in the oob behavior it is necessary to define the oob data and response in a manner that <code>compboost</code> understands it. Therefore, it is possible to use the <code>$prepareResponse()</code> and <code>$prepareData()</code> member functions to create suitable objects:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">oob_response =<span class="st"> </span>cboost<span class="op">$</span><span class="kw">prepareResponse</span>(df<span class="op">$</span>Survived[idx_test])</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">oob_data =<span class="st"> </span>cboost<span class="op">$</span><span class="kw">prepareData</span>(df[idx_test,])</a></code></pre></div>
<p>With these objects we can add the oob risk logger, declare it as stopper, and train the model:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">cboost<span class="op">$</span><span class="kw">addLogger</span>(<span class="dt">logger =</span> LoggerOobRisk, <span class="dt">use_as_stopper =</span> <span class="ot">TRUE</span>, <span class="dt">logger_id =</span> <span class="st">"oob"</span>,</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="dt">used_loss =</span> LossBinomial<span class="op">$</span><span class="kw">new</span>(), <span class="dt">eps_for_break =</span> <span class="dv">0</span>, <span class="dt">patience =</span> <span class="dv">5</span>, <span class="dt">oob_data =</span> oob_data,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">oob_response =</span> oob_response)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">cboost<span class="op">$</span><span class="kw">train</span>(<span class="dv">2000</span>, <span class="dt">trace =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;    1/2000   risk = 0.73  oob = 0.74   </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  100/2000   risk = 0.66  oob = 0.65   </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  200/2000   risk = 0.63  oob = 0.63   </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  300/2000   risk = 0.62  oob = 0.62   </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  400/2000   risk = 0.62  oob = 0.62   </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  500/2000   risk = 0.61  oob = 0.61   </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  600/2000   risk = 0.61  oob = 0.61   </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; Train 607 iterations in 0 Seconds.</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; Final risk based on the train set: 0.61</span></a></code></pre></div>
<p><strong>Note:</strong> The use of <code>eps_for_break = 0</code> is a hard constrain to continue the training just until the oob risk starts to increase.</p>
<p>Taking a look at the logger data tells us that we stop exactly after the first five differences are bigger than zero (the oob risk of these iterations are bigger than the previous ones):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(cboost<span class="op">$</span><span class="kw">getLoggerData</span>(), <span class="dt">n =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;     _iterations       oob</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; 598         598 0.6129652</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; 599         599 0.6130001</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; 600         600 0.6130251</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; 601         601 0.6130594</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; 602         602 0.6129339</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; 603         603 0.6129594</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; 604         604 0.6129938</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; 605         605 0.6129951</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; 606         606 0.6130281</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; 607         607 0.6130520</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diff">diff</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(cboost<span class="op">$</span><span class="kw">getLoggerData</span>()<span class="op">$</span>oob, <span class="dt">n =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; [1]  3.489823e-05  2.497266e-05  3.426060e-05 -1.254538e-04  2.548293e-05</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; [6]  3.438360e-05  1.304842e-06  3.298777e-05  2.390795e-05</span></a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data =</span> cboost<span class="op">$</span><span class="kw">getLoggerData</span>(), <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">_iterations</span><span class="st">`</span>, <span class="dt">y =</span> oob)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Iteration"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Empirical Risk"</span>)</a></code></pre></div>
<p><img src="early_stopping_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Taking a look at 2000 iterations shows that we have stopped quite good:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">cboost<span class="op">$</span><span class="kw">train</span>(<span class="dv">2000</span>, <span class="dt">trace =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; You have already trained 607 iterations.</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; Train 1393 additional iterations.</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data =</span> cboost<span class="op">$</span><span class="kw">getLoggerData</span>(), <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">_iterations</span><span class="st">`</span>, <span class="dt">y =</span> oob)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Iteration"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Empirical Risk"</span>)</a></code></pre></div>
<p><img src="early_stopping_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p><strong>Note:</strong> It could happen that the model’s oob behavior increases locally for a few iterations and then starts to decrease again. To capture this we need the “patience” parameter which waits for, lets say, 5 iterations and breaks just if all 5 iterations fulfill the criteria. Setting this parameter to one can lead to very unstable results:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">df =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(titanic<span class="op">::</span>titanic_train)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">df<span class="op">$</span>Survived =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(df<span class="op">$</span>Survived, <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"no"</span>, <span class="st">"yes"</span>))</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">idx_train =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(df)), <span class="dt">size =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(df) <span class="op">*</span><span class="st"> </span><span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">idx_test =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sets">setdiff</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(df)), idx_train)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">cboost =<span class="st"> </span>Compboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">data =</span> df[idx_train, ], <span class="dt">target =</span> <span class="st">"Survived"</span>, <span class="dt">loss =</span> LossBinomial<span class="op">$</span><span class="kw">new</span>())</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">cboost<span class="op">$</span><span class="kw">addBaselearner</span>(<span class="st">"Age"</span>, <span class="st">"spline"</span>, BaselearnerPSpline)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">cboost<span class="op">$</span><span class="kw">addBaselearner</span>(<span class="st">"Fare"</span>, <span class="st">"spline"</span>, BaselearnerPSpline)</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">cboost<span class="op">$</span><span class="kw">addBaselearner</span>(<span class="st">"Sex"</span>, <span class="st">"categorical"</span>, BaselearnerPolynomial, <span class="dt">intercept =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">oob_response =<span class="st"> </span>cboost<span class="op">$</span><span class="kw">prepareResponse</span>(df<span class="op">$</span>Survived[idx_test])</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">oob_data =<span class="st"> </span>cboost<span class="op">$</span><span class="kw">prepareData</span>(df[idx_test,])</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">cboost<span class="op">$</span><span class="kw">addLogger</span>(<span class="dt">logger =</span> LoggerOobRisk, <span class="dt">use_as_stopper =</span> <span class="ot">TRUE</span>, <span class="dt">logger_id =</span> <span class="st">"oob"</span>,</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">  <span class="dt">used_loss =</span> LossBinomial<span class="op">$</span><span class="kw">new</span>(), <span class="dt">eps_for_break =</span> <span class="dv">0</span>, <span class="dt">patience =</span> <span class="dv">1</span>, <span class="dt">oob_data =</span> oob_data,</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">  <span class="dt">oob_response =</span> oob_response)</a>
<a class="sourceLine" id="cb11-20" data-line-number="20"></a>
<a class="sourceLine" id="cb11-21" data-line-number="21">cboost<span class="op">$</span><span class="kw">train</span>(<span class="dv">2000</span>, <span class="dt">trace =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; Train 62 iterations in 0 Seconds.</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt; Final risk based on the train set: 0.68</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data =</span> cboost<span class="op">$</span><span class="kw">getLoggerData</span>(), <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">_iterations</span><span class="st">`</span>, <span class="dt">y =</span> oob)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Iteration"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Empirical Risk"</span>)</a></code></pre></div>
<p><img src="early_stopping_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="further-comments-on-risk-logging" class="section level3">
<h3 class="hasAnchor">
<a href="#further-comments-on-risk-logging" class="anchor"></a>Further comments on risk logging</h3>
<ul>
<li>Since we can define as many as logger as we like it is possible to define multiple risk logger regarding different loss functions.</li>
<li>It is also possible to log performance measures with the risk logging mechanism. This is covered as advanced topic.</li>
</ul>
</div>
</div>
<div id="some-remarks" class="section level2">
<h2 class="hasAnchor">
<a href="#some-remarks" class="anchor"></a>Some remarks</h2>
<ul>
<li>Early stopping can be done globally or locally:
<ul>
<li>
<em>locally</em>: The algorithm stops after <strong>the first</strong> stopping criteria of any logger is reached</li>
<li>
<em>globally</em>: The algorithm stops after <strong>all</strong> stopping criteria are reached</li>
</ul>
</li>
<li>Some arguments are ignored when the logger is not set as stopper, e.g. <code>max_time</code> from the time logger</li>
<li>The logger functionality is summarized <a href="https://danielschalk.com/compboost/articles/functionality/logger.html">here</a>
</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#before-starting">Before Starting</a></li>
      <li><a href="#data-titanic-passenger-survival-data-set">Data: Titanic Passenger Survival Data Set</a></li>
      <li><a href="#defining-the-model">Defining the Model</a></li>
      <li><a href="#early-stopping-in-compboost">Early Stopping in Compboost</a></li>
      <li><a href="#loss-based-early-stopping">Loss-Based Early Stopping</a></li>
      <li><a href="#some-remarks">Some remarks</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Schalk, Janek Thomas, Bernd Bischl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
